// Generated by CoffeeScript 1.8.0
(function() {
  var StormService, bgpdService, fs, merge,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  StormService = require('stormservice');

  merge = require('fmerge');

  fs = require('fs');

  bgpdService = (function(_super) {
    __extends(bgpdService, _super);

    bgpdService.prototype.schema = {
      name: "bgpd",
      type: "object",
      additionalProperties: true,
      properties: {
        hostname: {
          "type": "string",
          "required": true
        },
        password: {
          "type": "string",
          "required": true
        },
        'enable password': {
          "type": "string",
          "required": true
        },
        'log file': {
          "type": "string",
          "required": true
        },
        protocol: {
          name: "router",
          type: "object",
          required: true,
          additionalProperties: true,
          properties: {
            router: {
              type: "string",
              required: true
            },
            'bgp router-id': {
              type: "string",
              required: true
            },
            networks: {
              type: "array",
              items: {
                name: "network",
                type: "object",
                required: true,
                additionalProperties: true,
                properties: {
                  'network': {
                    type: "string",
                    required: false
                  }
                }
              }
            },
            neighbors: {
              type: "array",
              items: {
                name: " neighbor",
                type: "object",
                required: true,
                additionalProperties: true,
                properties: {
                  'neighbor': {
                    type: "string",
                    required: false
                  }
                }
              }
            }
          }
        }
      }
    };

    bgpdService.prototype.invocation = {
      name: 'bgpd',
      path: '/usr/lib/quagga',
      monitor: true,
      args: [],
      options: {
        detached: true,
        stdio: ["ignore", -1, -1]
      }
    };

    function bgpdService(id, data, opts) {
      if (data.instance != null) {
        this.instance = data.instance;
        delete data.instance;
      }
      if (opts == null) {
        opts = {};
      }
      if (opts.configPath == null) {
        opts.configPath = "/var/stormflash/plugins/quagga";
      }
      if (opts.logPath == null) {
        opts.logPath = "/var/log/bgpd";
      }
      bgpdService.__super__.constructor.call(this, id, data, opts);
      this.configs = {
        service: {
          filename: "" + this.configPath + "/bgpd_" + this.id + ".conf"
        }
      };
      this.invocation = merge(this.invocation, {
        args: ["--config_file", "" + this.configs.service.filename, "-d"],
        options: {
          stdio: ["ignore", this.out, this.err]
        }
      });
      this.configs.service.generator = (function(_this) {
        return function(callback) {
          var bgpdconfig, key, keyy, keyyy, objj, val, value, valuee, _i, _len, _ref;
          bgpdconfig = '';
          _ref = _this.data;
          for (key in _ref) {
            val = _ref[key];
            switch (typeof val) {
              case "object":
                for (keyy in val) {
                  value = val[keyy];
                  switch (typeof value) {
                    case "string":
                    case "number":
                      bgpdconfig += keyy + ' ' + value + "\n";
                      break;
                    case "object":
                      for (_i = 0, _len = value.length; _i < _len; _i++) {
                        objj = value[_i];
                        for (keyyy in objj) {
                          valuee = objj[keyyy];
                          bgpdconfig += keyyy + ' ' + valuee + "\n";
                        }
                      }
                  }
                }
                break;
              case "number":
              case "string":
                bgpdconfig += key + ' ' + val + "\n";
                break;
              case "boolean":
                bgpdconfig += key + "\n";
            }
          }
          return callback(bgpdconfig);
        };
      })(this);
    }

    bgpdService.prototype.getconfig = function() {
      return this.configs;
    };

    bgpdService.prototype.getinvocation = function() {
      return this.invocation;
    };

    bgpdService.prototype.destructor = function() {
      return this.eliminate();
    };

    return bgpdService;

  })(StormService);

  module.exports = bgpdService;

}).call(this);
